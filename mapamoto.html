<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa Motoca</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body, html { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([-23.55052, -46.633308], 12); // Ajuste inicial da cidade
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const motocaIcon = L.icon({
      iconUrl: 'https://img.icons8.com/color/48/000000/motorbike.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40]
    });

    const garupaIcon = L.icon({
      iconUrl: 'https://img.icons8.com/color/48/000000/user.png',
      iconSize: [35, 35],
      iconAnchor: [17, 35]
    });

    let markers = [];

    async function atualizarMapa() {
      try {
        const res = await fetch('https://moveme-backend-v80p.onrender.com/ativos_motoca');
        const data = await res.json();

        // Remove marcadores antigos
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        // Adiciona motocas
        data.motocas.forEach(motoca => {
          const marker = L.marker([motoca.latitude, motoca.longitude], { icon: motocaIcon })
            .bindPopup(`<b>Motoca:</b> ${motoca.nome}`);
          marker.addTo(map);
          markers.push(marker);
        });

        // Adiciona garupas
        data.garupas.forEach(garupa => {
          const marker = L.marker([garupa.latitude, garupa.longitude], { icon: garupaIcon })
            .bindPopup(`<b>Garupa:</b> ${garupa.nome}`);
          marker.addTo(map);
          markers.push(marker);
        });

      } catch (err) {
        console.error('Erro ao atualizar mapa:', err);
      }
    }

    atualizarMapa();
    setInterval(atualizarMapa, 5000); // Atualiza a cada 5 segundos
  </script>
</body>
</html>
