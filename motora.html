<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Motorista</title>

<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f4f4f4; }
  .container { width:100%; max-width:400px; margin:auto; padding:20px; }
  input, button { width:100%; padding:10px; margin:8px 0; border-radius:4px; border:1px solid #bbb; }
  button { background:#007bff; color:white; border:none; }
  button:hover { background:#0056b3; }
  #map { width:100%; height:300px; margin:10px 0; background:#ccc; }
  #msg { text-align:center; color:red; }
  #qrbox { width:100%; text-align:center; margin-bottom:15px; }
</style>

</head>
<body>

<div class="container">

  <!-- QR antes do login -->
  <div id="qrbox">
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=MOVE-ME-MOTORISTA" />
  </div>

  <!-- Login -->
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button id="btnLogin">Entrar</button>

  <!-- MAPA -->
  <div id="map"></div>

  <!-- Botões que sempre aparecem -->
  <button id="btnTerminar">Terminar Corrida</button>
  <button id="btnPagar">Pagar Corrida</button>

  <p id="msg"></p>

</div>

<script>
const API = "https://moveme-backend-v80p.onrender.com";

// ---- LOGIN MOTORISTA ----
document.getElementById("btnLogin").onclick = async () => {
  const email = document.getElementById("email").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const msg = document.getElementById("msg");

  msg.textContent = "";

  try {
    const res = await fetch(`${API}/motora`);
    const dados = await res.json();

    // busca motorista exato
    const m = dados.find(x => x.email === email && x.senha === senha);

    if (!m) {
      msg.textContent = "Login inválido";
      return;
    }

    window.motorista = m;
    msg.style.color = "green";
    msg.textContent = "Logado com sucesso";

    carregarMapa(m);

    carregarCorrida(m.id);

  } catch (e) {
    msg.textContent = "Erro de conexão";
  }
};


// ---- MAPA ----
let map;
function carregarMapa(m) {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: m.latitude || 0, lng: m.longitude || 0 },
    zoom: 15
  });

  new google.maps.Marker({
    position: { lat: m.latitude || 0, lng: m.longitude || 0 },
    map: map,
    title: m.nome
  });
}


// ---- PUXA TODA TABELA CORRIDAS ----
async function carregarCorrida(idMotora) {
  try {
    const res = await fetch(`${API}/corridas`);
    const lista = await res.json();

    // pega a corrida que pertence ao motorista
    const corrida = lista.find(c => c.motorista_id == idMotora);

    if (corrida) {
      console.log("CORRIDA COMPLETA:", corrida);
      window.corridaAtual = corrida;
    }

  } catch (e) {
    console.log("erro corridas");
  }
}


// ---- TERMINAR CORRIDA ----
document.getElementById("btnTerminar").onclick = () => {
  if (!window.corridaAtual) {
    alert("Nenhuma corrida ativa.");
    return;
  }
  alert("Corrida terminada.");
};

// ---- PAGAR CORRIDA ----
document.getElementById("btnPagar").onclick = () => {
  if (!window.corridaAtual) {
    alert("Nenhuma corrida ativa.");
    return;
  }
  alert("Corrida paga.");
};
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY"></script>
</body>
</html>
