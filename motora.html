<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teste Motorista</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; font-family: Arial; background:#f4f4f4; }
  .container { width:100%; max-width:500px; margin:auto; padding:20px; }
  input, button { width:100%; padding:10px; margin:8px 0; border:1px solid #bbb; }
  button { background:#007bff; color:white; border:none; }
  #map { width:100%; height:400px; background:#eee; }
</style>

<script>
const API = "https://moveme-backend-v80p.onrender.com";
let map, window.motorista;

// ---- LOGIN MOTORISTA ----
document.getElementById("btnLogin").onclick = async () => {
  const email = document.getElementById("email").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const msg = document.getElementById("msg");

  msg.textContent = "Fazendo login..."; // FEEDBACK IMEDIATO
  msg.style.color = "blue";

  try {
    console.log("Fazendo requisição para:", `${API}/motora`);
    const res = await fetch(`${API}/motora`);
    
    if (!res.ok) throw new Error("Erro na API");
    
    const dados = await res.json();
    console.log("Dados recebidos:", dados);

    const m = dados.find(x => x.email === email && x.senha === senha);

    if (!m) {
      msg.textContent = "Login inválido - email/senha incorretos";
      msg.style.color = "red";
      return;
    }

    window.motorista = m;
    msg.textContent = `Logado com sucesso! Bem-vindo ${m.nome}`;
    msg.style.color = "green";

    carregarMapa(m);
    carregarMinhasCorridas(m.id);

  } catch (e) {
    console.error("Erro completo:", e);
    msg.textContent = "Erro de conexão com o servidor";
    msg.style.color = "red";
  }
};

// ---- MAPA ----
function carregarMapa(motorista) {
  const lat = motorista.latitude || -15.7975;
  const lng = motorista.longitude || -47.8919;
  
  if (map) map.remove(); // Limpa mapa anterior
  
  map = L.map('map').setView([lat, lng], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  L.marker([lat, lng])
    .addTo(map)
    .bindPopup(`<b>${motorista.nome}</b><br>Motorista<br>Placa: ${motorista.placa}`)
    .openPopup();
    
  console.log("Mapa carregado para:", motorista.nome);
}

// ... resto do código igual
</script>








  
</head>
<body>

<div class="container">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="testeLogin()">Entrar (TESTE)</button>
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// FUNÇÃO SIMPLES DE TESTE
function testeLogin() {
  console.log("BOTÃO FUNCIONOU!");
  alert("JavaScript está funcionando!");
  
  // Tenta carregar mapa mesmo sem login
  var map = L.map('map').setView([-15.7975, -47.8919], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.marker([-15.7975, -47.8919]).addTo(map).bindPopup("Teste").openPopup();
  
  console.log("Mapa carregado!");
}

// Teste se carrega automaticamente
console.log("Página carregada");
testeLogin(); // Tenta carregar mapa automaticamente
</script>

<div class="container">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button id="btnLogin">Entrar</button>
  
  <!-- MENSAGEM DE STATUS -->
  <p id="msg" style="text-align:center; margin:10px 0; min-height:20px;"></p>
  
  <div class="botoes-corrida">
    <!-- botões -->
  </div>
  
  <div id="map"></div>
</div>

<script>
const API = "https://moveme-backend-v80p.onrender.com";
let map, window.motorista;

// ---- CONECTA O BOTÃO CORRETAMENTE ----
document.addEventListener('DOMContentLoaded', function() {
  console.log("Página carregada, conectando botão...");
  
  document.getElementById("btnLogin").addEventListener("click", function() {
    console.log("BOTÃO CLICADO - Iniciando login");
    fazerLogin();
  });
});

// ---- FUNÇÃO DE LOGIN ----
async function fazerLogin() {
  const email = document.getElementById("email").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const msg = document.getElementById("msg");

  console.log("Tentando login com:", email);

  if (!email || !senha) {
    msg.textContent = "Preencha email e senha";
    msg.style.color = "red";
    return;
  }

  msg.textContent = "Fazendo login...";
  msg.style.color = "blue";

  try {
    const res = await fetch(`${API}/motora`);
    console.log("Resposta da API:", res.status);
    
    const dados = await res.json();
    console.log("Dados recebidos:", dados);

    const m = dados.find(x => x.email === email && x.senha === senha);

    if (!m) {
      msg.textContent = "Login inválido";
      msg.style.color = "red";
      return;
    }

    window.motorista = m;
    msg.textContent = `Logado! ${m.nome}`;
    msg.style.color = "green";

    carregarMapa(m);

  } catch (e) {
    console.error("Erro:", e);
    msg.textContent = "Erro de conexão";
    msg.style.color = "red";
  }
}

// ---- MAPA ----
function carregarMapa(motorista) {
  const lat = motorista.latitude || -15.7975;
  const lng = motorista.longitude || -47.8919;
  
  if (map) map.remove();
  
  map = L.map('map').setView([lat, lng], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  L.marker([lat, lng])
    .addTo(map)
    .bindPopup(`<b>${motorista.nome}</b><br>Motorista`)
    .openPopup();
}
</script>




  
</body>
</html>
